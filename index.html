<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>fromSheetsToJekyll</title>
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
    <link rel="stylesheet" href="ripple.css">
    <style>
        .pageload-overlay {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            visibility: hidden;
            background: rgba(0,0,0,.7);
        }

        .pageload-overlay.show {
            visibility: visible;
        }

        .pageload-overlay .spin-container {
            margin: auto;
            position: absolute;
            top: 0; left: 0; bottom: 0; right: 0;
        }
    </style>
</head>
<body>
<div class="jumbotron">
    <div class="container">
        <h1>From Sheets to Jekyll</h1>
        <p>Turn your Google Sheets into Jekyll files</p>
    </div>
</div>
<div class="container">
    <div class="row">
        <div class="col-xs-12">
            <h2>Step 1: <small>Learn about the awesomeness of <a href="http://sheetsu.com/" target="_blank" alt="sheetsu.com">Sheetsu.com</a></small></h2>
            <p>Create an API, paste the URL below</p>
            <div class="form-group">
                <label for="getUrl" class="control-label">Sheetsu API URL</label>
                <input type="text" value="http://sheetsu.com/apis/fe179874" id="getUrl" class="form-control">
                <span class="glyphicon glyphicon-ok form-control-feedback hidden" aria-hidden="true" id="getUrlFeedback"></span>
                <span id="getUrlStatus" class="sr-only">gtg!</span>
            </div><!-- /input-group -->
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <h2>Step 2: <small>Check that your API works</small></h2>
            <div id="getUrlAlert" class="hidden alert alert-success">
                <h3>You're gtg, dude or dudette! <span class="glyphicon glyphicon-thumbs-up"></span></h3>
            </div>
            <button class="btn btn-default" type="button" id="checkUrl">Check</button>
        </div>
    </div>
</div>
<div class="container hidden" id="apiOk">
    <div class="row">
        <div class="col-xs-12">
            <h2>Step 3: <small>Choose what type of file you want to make</small></h2>
            <table class="table">
                <thead>
                <tr><th>Type</th><th>Description</th></tr>
                </thead>
                <tbody>
                <tr><td>Data File</td><td>Formatted as a jekyll data file that you can drop into your _data/ folder. Choose your key!</td></tr>
                <tr><td>Template</td><td>Create a template and propogate front matter. I hope, soon.</td></tr>
                <tr><td>Json</td><td>A simple json printout of your sheet. Pretty boring stuff...</td></tr>
                </tbody>
            </table>
            <!-- Nav tabs -->
            <ul class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active"><a href="#dataFile" aria-controls="dataFile" role="tab" data-toggle="tab">Jekyll Data File</a></li>
                <li role="presentation"><a href="#templates" aria-controls="templates" role="tab" data-toggle="tab">Templates</a></li>
                <li role="presentation"><a href="#simpleJson" aria-controls="simpleJson" role="tab" data-toggle="tab">Json</a></li>
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">
                <div role="tabpanel" class="tab-pane active" id="dataFile">
                    <h3>Make a Jekyll data file</h3>
                    <h4>Select A Key</h4>
                    <div id="dataFileKey"></div>
                </div>
                <div role="tabpanel" class="tab-pane" id="templates"><h3>Coming soon?</h3></div>
                <div role="tabpanel" class="tab-pane" id="simpleJson"><h3>No options here</h3></div>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <h2>Step 4: <small>Boomshakalaka!</small></h2>
            <button class="btn btn-default" id="boom">Boomshakalaka!</button>
        </div>
    </div>
    <div class="row">
        <div class="col-xs-12">
            <h2>Step 5: <small>DATA!</small></h2>
            <pre id="response"></pre>
        </div>
    </div>
</div>
</body>
<div id="loader" class="pageload-overlay">
    <div class="spin-container">
        <div class="spinner">
            <div class="rect1"></div>
            <div class="rect2"></div>
            <div class="rect3"></div>
            <div class="rect4"></div>
            <div class="rect5"></div>
        </div>
    </div>
</div><!-- /pageload-overlay -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
<script>
    $(function(){

        $( document ).ajaxStart(function() {
            $( "#loader" ).addClass('show');
        });
        $( document ).ajaxComplete(function() {
            $( "#loader" ).removeClass('show');
        });

        function getSheetsu(wtd){
            var url = $('#getUrl').val();
            if(wtd == 'dataFile'){
                var key = $('[name="dataFileKey"]:checked').val();
                if(typeof key == 'undefined'){
                    alert('Please select a key');
                    return;
                }
            }
            $.ajax({
                url: url,
                success: function(response, status, jqXHR) {
                    switch(wtd){
                        case 'check':
                            if(response.status == 200){
                                $('#getUrlFeedback, #getUrlAlert, #apiOk').removeClass('hidden');
                                $('#getUrl').parents('.form-group').addClass('has-feedback has-success');
                                var singleResponse = response.result[0];
                                $.each(singleResponse,function(i,v){
                                    var normIndex = i.replace(' ','-');
                                   $('#dataFileKey').append('<div class="radio"><label><input type="radio" name="dataFileKey" id="'+normIndex+'" value="'+i+'">'+i+'</label></div>');
                                });
                            }
                            break;
                        case 'simpleJson':
                            $('#response').html(JSON.stringify(response.result));
                            break;
                        case 'dataFile':
                            var key = $('[name="dataFileKey"]:checked').val();
                            var returnString = '';
                            $.each(response.result,function(index,value){
                                var dataKey = value[key].replace(/[^\w\s\d]/gi,'');
                                dataKey = dataKey.replace(/[\s]/gi,'-');
                                returnString += dataKey+':\n';
                                $.each(value,function(i,v){
                                    returnString += '  '+i+': '+v+'\n';
                                });
                                returnString += '\n';
                            });
                            $('#response').html(returnString);
                            break;
                    }
                }
            });
        }

        $('#checkUrl').click(function(){
            getSheetsu('check');
        });

        $('#boom').click(function(){
            var wtd = $('.tab-pane.active').attr('id');
            getSheetsu(wtd);
        });

    });
</script>
</html>